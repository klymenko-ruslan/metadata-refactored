<div id="dlgDeleteLegend" class="modal fade" tabindex="-1" role="dialog">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title">Delete this image with legend?</h4>
      </div>
      <div class="modal-body">
        <p>Do you want to remove this image from these critical dimensions?</p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
        <button type="button" class="btn btn-primary" data-ng-click="deleteLegend()">Delete!</button>
      </div>
    </div>
  </div>
</div>

<div id="dlgUploadLegend" class="modal fade" tabindex="-1" role="dialog">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h3 class="modal-title">Upload JPG Image</h3>
      </div>
      <div class="modal-body">
        <form>
          <input type="file" name="file" onchange="angular.element(this).scope().onSelectLegendImage(this.files)"/>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
        <button type="button" class="btn btn-primary" ng-click="uploadLegend()">Upload</button>
      </div>
    </div>
  </div>
</div>

<div class="row" style="padding-bottom:15px;">
  <div class="col-xs-12">
    <div class="row text-right">
      <a href="#legend" class="col-xs-12" data-toggle="collapse">Toggle Legend</a>
    </div>
    <div id="legend" class="row collapse">
      <div class="col-xs-12">
        <div class="row" style="padding:10px 0;">
          <div class="col-xs-12">
            <button class="btn btn-primary pull-right" data-toggle="modal" data-target="#dlgUploadLegend">
              <i class="fa fa-plus"></i>
              Add/Replace Image...
            </button>
          </div>
        </div>
        <div class="row">
          <div data-ng-class="['col-xs-12', {'clicked-row': part.cdLegendUrl}]" data-ng-click="showDeleteLegendDlg()">
            <img src="{{part.cdLegendUrl}}" class="center-block" data-ng-show="part.cdLegendUrl" />
            <div class="no-image" data-ng-hide="part.cdLegendUrl"></div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<form name="filterForm" class="form-horizontal" novalidate>
  <div class="form-group">
    <div class="col-xs-2">
      <div class="checkbox">
        <label>
          <input type="checkbox" data-ng-model="opts.hideBlank" data-ng-disabled="isEditing()" />Hide&nbsp;blank
        </label>
      </div>
    </div>
    <div class="col-xs-3">
      <div class="checkbox">
        <label>
          <input type="checkbox" data-ng-model="opts.inlineLayout" data-ng-disabled="isEditing()" />Inline&nbsp;layout
        </label>
      </div>
    </div>
    <div class="col-xs-7">
      <input type="text" class="form-control" data-ng-model="opts.filter" data-ng-model-options="{debounce:300}" data-ng-trim="true" placeholder="Filter" data-ng-disabled="isEditing()" />
    </div>
  </div>
  <hr/>
</form>

<form name="cdForm" class="form-horizontal" novalidate>
  <div class="form-group">
    <div class="col-xs-12">
      <div class="pull-right">
        <button data-ng-click="modifyStartAll()" data-ng-hide="isEditing()" authorize="ROLE_ALTER_PART" class="btn btn-primary">
          <i class="fa fa-cog"></i> Modify All
        </button>
        <button data-ng-click="modifySaveAll()" data-ng-show="isEditing()" authorize="ROLE_ALTER_PART" class="btn btn-success ng-hide" data-ng-disabled="cdForm.$pristine || cdForm.$invalid || cdForm.$pending">
          <i class="fa fa-save"></i> Save All
        </button>
        <button data-ng-click="modifyUndoAll()" data-ng-show="isEditing()" data-ng-disabled="cdForm.$pristine || cdForm.$pending" class="btn btn-warning ng-hide">
          <i class="fa fa-undo"></i> Undo All
        </button>
        <button data-ng-click="modifyCancelAll()" data-ng-show="isEditing()" class="btn btn-warning">
          <i class="fa fa-minus-circle"></i> Cancel All
        </button>
      </div>
    </div>
  </div>

  <div class="form-group">
    <div class="col-xs-12">
      <table class="table table-striped table-condensed critical-dimensions">
        <tr data-ng-repeat="d in toDisplay">
          <td style="width:30%;" class="text-uppercase">{{d.displayName}}</td>
          <td data-ng-class="{'bg-danger': d.invalidDisplayValue}">
            <span data-ng-hide="isModifying(d)">{{d.displayValue}}</span>
            <div data-ng-show="isModifying(d)" data-ng-if="::!d.invalidDisplayValue">
              <select name="{{::d.jsonName}}" data-ng-if="d.selectOptions" ng-options="item.val for item in d.selectOptions track by item.id" data-ng-model="editedPart[d.jsonName]">
                <option value="" data-ng-if="::d.valueDescriptor.nullAllowed">{{::d.valueDescriptor.nullDisplay}}</option>
              </select>
              <input
                name="{{::d.jsonName}}" type="{{::d.inputType}}"
                title="{{errors[d.jsonName]}}"
                data-ng-if="::!d.selectOptions" data-ng-model="editedPart[d.jsonName]"
                data-ng-required="::!d.valueDescriptor.nullAllowed"
                data-ng-min="::d.valueDescriptor.minVal" data-ng-max="::d.valueDescriptor.maxVal"
                data-ng-maxlength="::d.valueDescriptor.length"
                data-ng-pattern="::d.valueDescriptor.regex"
                critical-dimension-validator="d"
                data-ng-trim="true" />
              <span data-ng-if="d.toleranceJsonName">&plusmn;</span>
              <input
                name="{{::d.toleranceJsonName}}" type="{{::d.toleranceInputType}}"
                title="{{errors[d.toleranceJsonName]}}"
                data-ng-if="::d.toleranceJsonName" data-ng-model="editedPart[d.toleranceJsonName]"
                data-ng-required="::!d.toleranceDescriptor.nullAllowed"
                data-ng-min="::d.toleranceDescriptor.minVal" data-ng-max="::d.toleranceDescriptor.maxVal"
                data-ng-maxlength="::d.toleranceDescriptor.length"
                data-ng-pattern="::d.toleranceDescriptor.regex"
                critical-dimension-validator="d"
                data-ng-trim="true" />
            </div>
          </td>
          <td class="text-right">
            <button data-ng-click="modifyStart(d)" authorize="ROLE_ALTER_PART" data-ng-hide="isModifying(d)" data-ng-disabled="{{::d.invalidDisplayValue}}" class="btn btn-primary btn-xs">
              <i class="fa fa-cog"></i> Modify
            </button>
            <button data-ng-click="modifyUndo(d)" data-ng-show="isModifying(d)" data-ng-disabled="cdForm.$pristine || cdForm.$pending" class="btn btn-warning btn-xs ng-hide">
              <i class="fa fa-undo"></i> Undo
            </button>
            <button data-ng-click="modifyCancel(d)" data-ng-show="isModifying(d)" class="btn btn-warning btn-xs">
              <i class="fa fa-minus-circle"></i> Cancel
            </button>
          </td>
        </tr>
        <tr ng-hide="toDisplay.length > 0">
          <td colspan="3">No rows to display.</td>
        </tr>
      </table>
    </div>
  </div>

</form>
