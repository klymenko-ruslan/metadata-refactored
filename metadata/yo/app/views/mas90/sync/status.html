<metanav authorize="ROLE_ADMIN" />

<div class="row">

  <div ng-hide="!finished">
    <button ng-click="startSync()" authorize="ROLE_ADMIN" class="btn btn-primary btn-lg active">
      <i class="fa fa-flag"></i> Start
    </button>
    <span style="padding-left:1em;">
      Start synchronization process between ERP (<i>MAS90</i>) and local database.
    </span>
  </div>

  <div class="modal-dialog" ng-hide="finished">
    <div class="modal-content">
      <div class="modal-header">
        <h3 class="modal-title">Progress of synchronization</h3>
      </div>
      <div class="modal-body">
        <div>
          <h4>Updating of parts (Step 1/2)</h4>
          <div ng-hide="partsUpdateTotalSteps">
            <p>
              Job size estimating. Please wait...&nbsp;<i class="fa fa-circle-o-notch fa-spin"></i>
            </p>
          </div>
          <div ng-hide="!partsUpdateTotalSteps">
            <p>
              <uib-progressbar type="info" max="partsUpdateTotalSteps" value="partsUpdateCurrentStep" ng-class="{'progress-striped active': phase == 0}">
                <span style="color:white; white-space:nowrap;">{{partsUpdateCurrentStep}} / {{partsUpdateTotalSteps}}</span>
              </uib-progressbar>
              <div>
                <span>Updated: {{partsUpdateUpdates | number:0}}</span><span style="padding-left:3em;">Inserted: {{partsUpdateInserts | number:0}}</span>
              </div>
            </p>
          </div>
        </div>
        <div data-ng-hide="phase < 1">
          <h4>Updating of BOM (Step 2/2)</h4>
          <div ng-hide="bomUpdateTotalSteps">
            <p>
              Job size estimating. Please wait...&nbsp;<i class="fa fa-circle-o-notch fa-spin"></i>
            </p>
          </div>
          <div ng-hide="!bomUpdateTotalSteps">
            <p>
              <div>
                <span>Updated: {{bomUpdateUpdates | number:0}}</span><span style="padding-left:3em;">Inserted: {{bomUpdateInserts | number:0}}</span>
              </div>
              <uib-progressbar type="info" max="bomUpdateTotalSteps" value="bomUpdateCurrentStep" class="progress-striped active">
                <span style="color:white; white-space:nowrap;">{{bomUpdateCurrentStep}} / {{bomUpdateTotalSteps}}</span>
              </uib-progressbar>
            </p>
          </div>
        </div>
        <hr/>
        <p ng-hide="userId">The process started on {{startedOn | date : "yyyy-MM-dd HH:mm.ss"}} by scheduler.</p>
        <p ng-hide="!userId">The process started on {{startedOn | date : "yyyy-MM-dd HH:mm.ss"}} by <a ng-href="security/user/{{userId}}">{{userName}}</a>.</p>
      </div>

    </div>
  </div>

</div>

<div class="row" style="margin-top:3em;">

  <h2>History of synchronization sessions</h2>

  <div class="col-xs-12 col-sm-9">
    <table data-ng-table="mas90syncHistoryTableParams" class="table table-bordered table-striped">
      <tr data-ng-repeat="rec in $data">
        <td title="'Started'" class="text-center">{{rec.started | date : "yyyy-MM-dd HH:mm.ss"}}</td>
        <td title="'Finished'" class="text-center">{{rec.finished | date : "yyyy-MM-dd HH:mm.ss"}}</td>
        <td title="'To Process'" class="text-right">{{rec.toProcess | number:0}}</td>
        <td title="'Updated'" class="text-right">{{rec.updated | number:0}}</td>
        <td title="'Inserted'" class="text-right">{{rec.inserted | number:0}}</td>
        <td title="'Started By'"><a ng-href="security/user/{{rec.user.id}}">{{rec.user.name}}</a></td>
        <td title="'Status'" class="text-center">{{rec.status}}</td>
      </tr>
      <tr ng-hide="$data.length > 0">
        <td colspan="7">No records to display.</td>
      </tr>
    </table>
  </div>

</div>
